<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“äº¤æ˜“ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-btn.active { background-color: #2563eb; color: white; }
        .tab-btn:not(.active) { background-color: #e5e7eb; color: #374151; }
        .tab-btn:hover:not(.active) { background-color: #d1d5db; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
<!-- é¡¶éƒ¨å¯¼èˆª -->
<header class="bg-white shadow fixed w-full top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
        <h1 class="text-xl font-bold text-blue-600">ğŸ“¦ å•†å“äº¤æ˜“ç³»ç»Ÿ/å‰ç«¯ä¹ƒè±†åŒ…å¤§ä½œï¼Œæ”¹äº†çœŸä¹…</h1>
        <div id="userNav" class="flex items-center gap-4">
            <span id="currentUser" class="hidden text-gray-700"></span>
            <button id="logoutBtn" class="hidden bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">é€€å‡ºç™»å½•</button>
        </div>
    </div>
</header>

<!-- ä¸»å†…å®¹åŒº -->
<main class="container mx-auto px-4 pt-20 pb-16">
    <!-- æ¶ˆæ¯æç¤ºæ¡† -->
    <div id="msgBox" class="fixed top-20 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-md text-white font-medium z-50 hidden transition-all duration-300">
        <i class="fa fa-info-circle mr-2"></i>
        <span id="msgText"></span>
    </div>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢æŒ‰é’® -->
    <div class="flex flex-wrap gap-2 my-6">
        <button class="tab-btn active px-4 py-2 rounded transition" data-tab="auth">ç™»å½•/æ³¨å†Œ</button>
        <button class="tab-btn px-4 py-2 rounded transition" data-tab="user">ç”¨æˆ·ç®¡ç†</button>
        <button class="tab-btn px-4 py-2 rounded transition" data-tab="product">å•†å“ç®¡ç†</button>
        <button class="tab-btn px-4 py-2 rounded transition" data-tab="order">è®¢å•ç®¡ç†</button>
    </div>

    <!-- 1. ç™»å½•/æ³¨å†Œæ ‡ç­¾é¡µ -->
    <div class="tab-content active" id="auth-tab">
        <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
            <!-- ç™»å½•è¡¨å• -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-6 text-center text-gray-800">ç”¨æˆ·ç™»å½•</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1" for="loginUsername">ç”¨æˆ·å</label>
                        <input type="text" id="loginUsername" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1" for="loginPassword">å¯†ç </label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                        <i class="fa fa-sign-in mr-2"></i>ç™»å½•
                    </button>
                </form>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-6 text-center text-gray-800">ç”¨æˆ·æ³¨å†Œ</h2>
                <form id="registerForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1" for="regUsername">ç”¨æˆ·å</label>
                        <input type="text" id="regUsername" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1" for="regPassword">å¯†ç </label>
                        <input type="password" id="regPassword" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1" for="regPhone">æ‰‹æœºå·</label>
                        <input type="tel" id="regPhone" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">
                        <i class="fa fa-user-plus mr-2"></i>æ³¨å†Œ
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 2. ç”¨æˆ·ç®¡ç†æ ‡ç­¾é¡µ -->
    <div class="tab-content" id="user-tab">
        <div class="max-w-6xl mx-auto space-y-6">
            <!-- è®¾ä¸ºç®¡ç†å‘˜ -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-4 text-gray-800">è®¾ç½®ç®¡ç†å‘˜</h2>
                <form id="toAdminForm" class="flex gap-4 items-end max-w-md">
                    <div class="flex-1">
                        <label class="block text-gray-700 mb-1" for="adminUserId">ç”¨æˆ·ID</label>
                        <input type="number" id="adminUserId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition">
                        <i class="fa fa-shield mr-2"></i>è®¾ä¸ºç®¡ç†å‘˜
                    </button>
                </form>
            </div>

            <!-- æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ· -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨</h2>
                    <button id="queryAllUsers" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                        <i class="fa fa-search mr-2"></i>æŸ¥è¯¢ç”¨æˆ·
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full border-collapse">
                        <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-3 border-b text-left">ç”¨æˆ·ID</th>
                            <th class="px-4 py-3 border-b text-left">ç”¨æˆ·å</th>
                            <th class="px-4 py-3 border-b text-left">æ‰‹æœºå·</th>
                            <th class="px-4 py-3 border-b text-left">è§’è‰²</th>
                        </tr>
                        </thead>
                        <tbody id="userTableBody">
                        <tr>
                            <td colspan="4" class="px-4 py-8 text-center text-gray-500">ç‚¹å‡»ä¸Šæ–¹"æŸ¥è¯¢ç”¨æˆ·"åŠ è½½æ•°æ®</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- åˆ é™¤ç”¨æˆ· -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-4 text-gray-800">åˆ é™¤ç”¨æˆ·</h2>
                <form id="deleteUserForm" class="flex gap-4 items-end max-w-md">
                    <div class="flex-1">
                        <label class="block text-gray-700 mb-1" for="deleteUserId">ç”¨æˆ·ID</label>
                        <input type="number" id="deleteUserId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                        <i class="fa fa-trash mr-2"></i>åˆ é™¤ç”¨æˆ·
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 3. å•†å“ç®¡ç†æ ‡ç­¾é¡µ -->
    <div class="tab-content" id="product-tab">
        <div class="max-w-6xl mx-auto space-y-6">
            <!-- å•†å“æŸ¥è¯¢åŒºåŸŸ -->
            <div class="grid md:grid-cols-3 gap-6">
                <!-- 24å°æ—¶å†…å•†å“ -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">24å°æ—¶å†…æ–°å¢å•†å“</h3>
                    <button id="query24hProducts" class="w-full bg-blue-600 text-white py-2 rounded mb-4 hover:bg-blue-700 transition">
                        <i class="fa fa-clock-o mr-2"></i>æŸ¥è¯¢æœ€æ–°å•†å“
                    </button>
                    <div id="24hProductsList" class="max-h-60 overflow-y-auto space-y-2">
                        <div class="text-center text-gray-500 py-4">ç‚¹å‡»æŸ¥è¯¢åŠ è½½æ•°æ®</div>
                    </div>
                </div>

                <!-- ä»·æ ¼åŒºé—´æŸ¥è¯¢ -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">ä»·æ ¼åŒºé—´æŸ¥è¯¢</h3>
                    <form id="priceQueryForm" class="space-y-3 mb-4">
                        <div>
                            <label class="block text-gray-700 text-sm mb-1" for="minPrice">æœ€ä½ä»·æ ¼</label>
                            <input type="number" step="0.01" id="minPrice" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm mb-1" for="maxPrice">æœ€é«˜ä»·æ ¼</label>
                            <input type="number" step="0.01" id="maxPrice" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">
                            <i class="fa fa-filter mr-2"></i>æŸ¥è¯¢
                        </button>
                    </form>
                    <div id="priceProductsList" class="max-h-40 overflow-y-auto space-y-2">
                        <div class="text-center text-gray-500 py-2">æŸ¥è¯¢åæ˜¾ç¤ºç»“æœ</div>
                    </div>
                </div>

                <!-- å•†å“æ ‡é¢˜åˆ—è¡¨ -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">æ‰€æœ‰å•†å“æ ‡é¢˜</h3>
                    <button id="queryAllTitles" class="w-full bg-blue-600 text-white py-2 rounded mb-4 hover:bg-blue-700 transition">
                        <i class="fa fa-list mr-2"></i>åŠ è½½æ ‡é¢˜
                    </button>
                    <div id="allTitlesList" class="max-h-60 overflow-y-auto space-y-2">
                        <div class="text-center text-gray-500 py-4">ç‚¹å‡»åŠ è½½æ•°æ®</div>
                    </div>
                </div>
            </div>

            <!-- å•†å“è¯¦æƒ…æŸ¥è¯¢ -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">æŸ¥è¯¢å•†å“è¯¦æƒ…</h2>
                </div>
                <form id="productDetailForm" class="flex gap-4 items-end max-w-2xl mb-6">
                    <div class="flex-1">
                        <label class="block text-gray-700 mb-1" for="productTitle">å•†å“æ ‡é¢˜</label>
                        <input type="text" id="productTitle" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                        <i class="fa fa-info-circle mr-2"></i>æŸ¥è¯¢è¯¦æƒ…
                    </button>
                </form>
                <div id="productDetailContainer" class="border rounded p-4 hidden">
                    <h3 class="text-lg font-bold mb-3 text-gray-800">å•†å“è¯¦æƒ…</h3>
                    <pre id="productDetailContent" class="whitespace-pre-wrap max-h-60 overflow-y-auto text-gray-700"></pre>
                </div>
            </div>

            <!-- æ–°å¢å•†å“ -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-bold mb-6 text-gray-800">æ–°å¢å•†å“</h2>
                <form id="addProductForm" class="grid md:grid-cols-2 gap-4 max-w-4xl">
                    <div>
                        <label class="block text-gray-700 mb-1" for="newProductTitle">å•†å“æ ‡é¢˜</label>
                        <input type="text" id="newProductTitle" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1" for="newProductType">å•†å“ç±»å‹</label>
                        <select id="newProductType" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">é€‰æ‹©ç±»å‹</option>
                            <option value="äºŒæ‰‹ç‰©å“">äºŒæ‰‹ç‰©å“</option>
                            <option value="ä»£å–éœ€æ±‚">ä»£å–éœ€æ±‚</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1" for="newProductPrice">å•†å“ä»·æ ¼</label>
                        <input type="number" step="0.01" id="newProductPrice" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1" for="newPublisherId">å‘å¸ƒè€…IDï¼ˆå½“å‰ç”¨æˆ·IDï¼‰</label>
                        <input type="number" id="newPublisherId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" readonly required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-1" for="newProductDesc">å•†å“æè¿°</label>
                        <textarea id="newProductDesc" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 mb-1" for="newProductStatus">å•†å“çŠ¶æ€</label>
                        <select id="newProductStatus" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="æœªå”®å‡º">æœªå”®å‡º</option>
                            <option value="å·²å”®å‡º">å·²å”®å‡º</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">
                            <i class="fa fa-plus-circle mr-2"></i>æ–°å¢å•†å“
                        </button>
                    </div>
                </form>
            </div>

            <!-- æ›´æ–°/åˆ é™¤å•†å“ -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- æ›´æ–°å•†å“è¡¨å•ï¼šæœ€ç»ˆæ­£ç¡®ç‰ˆæœ¬ -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-6 text-gray-800">æ›´æ–°å•†å“/èƒ½æ›´æ”¹ï¼Œæ²¡æ³•è¿”å›ç»“æœ</h2>
                    <form id="updateProductForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-1" for="updateProductId">å•†å“ID</label>
                            <input type="number" id="updateProductId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="updateProductTitle">æ–°æ ‡é¢˜</label>
                            <input type="text" id="updateProductTitle" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="updateProductDesc">æ–°æè¿°</label>
                            <textarea id="updateProductDesc" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="updateProductType">æ–°ç±»å‹</label>
                            <select id="updateProductType" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="äºŒæ‰‹ç‰©å“">äºŒæ‰‹ç‰©å“</option>
                                <option value="ä»£å–éœ€æ±‚">ä»£å–éœ€æ±‚</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="updateProductPrice">æ–°ä»·æ ¼</label>
                            <input type="number" step="0.01" id="updateProductPrice"
                                   class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   inputmode="decimal" required>
                            <p class="text-xs text-gray-500 mt-1">è¯·è¾“å…¥æ•°å­—ï¼ˆæœ€å¤š2ä½å°æ•°ï¼‰</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="updateProductStatus">æ–°çŠ¶æ€</label>
                            <select id="updateProductStatus" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="æœªå”®å‡º">æœªå”®å‡º</option>
                                <option value="å·²å”®å‡º">å·²å”®å‡º</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                            <i class="fa fa-edit mr-2"></i>æ›´æ–°å•†å“
                        </button>
                    </form>
                </div>

                <!-- åˆ é™¤å•†å“ -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-6 text-gray-800">åˆ é™¤å•†å“</h2>
                    <form id="deleteProductForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-1" for="deleteProductId">å•†å“ID</label>
                            <input type="number" id="deleteProductId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <button type="submit" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 transition">
                            <i class="fa fa-trash mr-2"></i>åˆ é™¤å•†å“
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. è®¢å•ç®¡ç†æ ‡ç­¾é¡µ -->
    <div class="tab-content" id="order-tab">
        <div class="max-w-6xl mx-auto space-y-6">
            <!-- ä¸‹å•/å–æ¶ˆè®¢å• -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- ä¸‹å•è¡¨å• -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-6 text-center text-gray-800">åˆ›å»ºè®¢å•</h2>
                    <form id="createOrderForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-1" for="orderBuyerId">ä¹°å®¶ID</label>
                            <input type="number" id="orderBuyerId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="orderProductId">å•†å“ID</label>
                            <input type="number" id="orderProductId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">
                            <i class="fa fa-shopping-cart mr-2"></i>ç¡®è®¤ä¸‹å•
                        </button>
                    </form>
                </div>

                <!-- å–æ¶ˆè®¢å•è¡¨å• -->
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-6 text-center text-gray-800">å–æ¶ˆè®¢å•</h2>
                    <form id="cancelOrderForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 mb-1" for="cancelBuyerId">ä¹°å®¶ID</label>
                            <input type="number" id="cancelBuyerId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1" for="cancelProductId">å•†å“ID</label>
                            <input type="number" id="cancelProductId" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <button type="submit" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600 transition">
                            <i class="fa fa-times-circle mr-2"></i>å–æ¶ˆè®¢å•
                        </button>
                    </form>
                </div>
            </div>

            <!-- æŸ¥è¯¢æ‰€æœ‰è®¢å• -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">æ‰€æœ‰è®¢å•åˆ—è¡¨</h2>
                    <button id="queryAllOrders" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                        <i class="fa fa-list-alt mr-2"></i>æŸ¥è¯¢è®¢å•
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full border-collapse">
                        <thead>
                        <tr class="bg-gray-100">
                            <th class="px-4 py-3 border-b text-left">è®¢å•ID</th>
                            <th class="px-4 py-3 border-b text-left">ä¹°å®¶ID</th>
                            <th class="px-4 py-3 border-b text-left">å•†å“ID</th>
                            <th class="px-4 py-3 border-b text-left">è®¢å•çŠ¶æ€</th>
                            <th class="px-4 py-3 border-b text-left">åˆ›å»ºæ—¶é—´</th>
                        </tr>
                        </thead>
                        <tbody id="orderTableBody">
                        <tr>
                            <td colspan="5" class="px-4 py-8 text-center text-gray-500">ç‚¹å‡»ä¸Šæ–¹"æŸ¥è¯¢è®¢å•"åŠ è½½æ•°æ®</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // å…¨å±€é…ç½®
    const API_BASE = 'http://47.109.204.208:8080';
    let token = localStorage.getItem('token') || '';
    let currentUser = {
        id: localStorage.getItem('userId') || '',
        username: localStorage.getItem('username') || '',
        role: localStorage.getItem('role') || 'USER'
    };

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        initTabs();
        bindAllEvents();
        updateLoginStatus();
        // è‡ªåŠ¨å¡«å……å½“å‰ç”¨æˆ·IDåˆ°å‘å¸ƒè€…IDå­—æ®µ
        if (currentUser.id) {
            document.getElementById('newPublisherId').value = currentUser.id;
            document.getElementById('updatePublisherId').value = currentUser.id;
        }
    });

    // 1. æ ‡ç­¾é¡µåˆ‡æ¢åˆå§‹åŒ–
    function initTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // åˆ‡æ¢å†…å®¹åŒºåŸŸ
                const tabId = btn.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}-tab`).classList.add('active');

                // æœªç™»å½•æ‹¦æˆªï¼ˆé™¤äº†ç™»å½•/æ³¨å†Œé¡µï¼‰
                if (tabId !== 'auth' && !token) {
                    showMsg('è¯·å…ˆç™»å½•åæ“ä½œï¼', 'error');
                    setTimeout(() => {
                        document.querySelector('.tab-btn[data-tab="auth"]').click();
                    }, 1500);
                }
            });
        });
    }

    // 2. ç»‘å®šæ‰€æœ‰è¡¨å•/æŒ‰é’®äº‹ä»¶
    function bindAllEvents() {
        // ç™»å½•/æ³¨å†Œ
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('registerForm').addEventListener('submit', handleRegister);
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);

        // ç”¨æˆ·ç®¡ç†
        document.getElementById('toAdminForm').addEventListener('submit', handleToAdmin);
        document.getElementById('queryAllUsers').addEventListener('click', queryAllUsers);
        document.getElementById('deleteUserForm').addEventListener('submit', handleDeleteUser);

        // å•†å“ç®¡ç†
        document.getElementById('query24hProducts').addEventListener('click', query24hProducts);
        document.getElementById('priceQueryForm').addEventListener('submit', queryProductsByPrice);
        document.getElementById('queryAllTitles').addEventListener('click', queryAllProductTitles);
        document.getElementById('productDetailForm').addEventListener('submit', queryProductDetail);
        document.getElementById('addProductForm').addEventListener('submit', handleAddProduct);
        document.getElementById('updateProductForm').addEventListener('submit', handleUpdateProduct);
        document.getElementById('deleteProductForm').addEventListener('submit', handleDeleteProduct);

        // è®¢å•ç®¡ç†
        document.getElementById('createOrderForm').addEventListener('submit', handleCreateOrder);
        document.getElementById('cancelOrderForm').addEventListener('submit', handleCancelOrder);
        document.getElementById('queryAllOrders').addEventListener('click', queryAllOrders);
    }

    // 3. é€šç”¨å·¥å…·å‡½æ•°
    /**
     * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
     * @param {string} text - æ¶ˆæ¯å†…å®¹
     * @param {string} type - ç±»å‹ï¼šsuccess/error/warning
     */
    function showMsg(text, type = 'success') {
        const msgBox = document.getElementById('msgBox');
        const msgText = document.getElementById('msgText');
        msgText.textContent = text;

        // è®¾ç½®æ ·å¼
        msgBox.classList.remove('bg-green-500', 'bg-red-500', 'bg-yellow-500', 'hidden');
        switch(type) {
            case 'error':
                msgBox.classList.add('bg-red-500');
                msgBox.innerHTML = `<i class="fa fa-exclamation-circle mr-2"></i>${text}`;
                break;
            case 'warning':
                msgBox.classList.add('bg-yellow-500');
                msgBox.innerHTML = `<i class="fa fa-warning mr-2"></i>${text}`;
                break;
            default:
                msgBox.classList.add('bg-green-500');
                msgBox.innerHTML = `<i class="fa fa-check-circle mr-2"></i>${text}`;
        }

        // 3ç§’åéšè—
        setTimeout(() => {
            msgBox.classList.add('hidden');
        }, 3000);
    }

    /**
     * è·å–è¯·æ±‚å¤´ï¼ˆå¸¦tokenï¼‰
     * @returns {Object} è¯·æ±‚å¤´å¯¹è±¡
     */
    function getRequestHeaders() {
        return {
            'Content-Type': 'application/json',
            'token': token || ''
        };
    }

    /**
     * è§£æåç«¯å“åº”ï¼ˆå…¼å®¹Resultå’Œç›´æ¥è¿”å›çš„Listï¼‰
     * @param {Response} response - å“åº”å¯¹è±¡
     * @returns {Object|Array} è§£æåçš„æ•°æ®
     */
    async function parseResponse(response) {
        try {
            const rawData = await response.text();
            // å°è¯•è§£æä¸ºJSON
            try {
                return JSON.parse(rawData);
            } catch (e) {
                // éJSONæ ¼å¼ï¼ˆå¦‚çº¯å­—ç¬¦ä¸²ï¼‰
                return { code: 0, msg: rawData };
            }
        } catch (e) {
            return { code: 0, msg: 'å“åº”è§£æå¤±è´¥' };
        }
    }

    /**
     * æ›´æ–°ç™»å½•çŠ¶æ€
     */
    function updateLoginStatus() {
        if (token && currentUser.username) {
            document.getElementById('currentUser').textContent = `å½“å‰ç”¨æˆ·ï¼š${currentUser.username}ï¼ˆ${currentUser.role}ï¼‰`;
            document.getElementById('currentUser').classList.remove('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
        } else {
            document.getElementById('currentUser').classList.add('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
        }
    }

    // 4. ç™»å½•/æ³¨å†Œ/é€€å‡ºç›¸å…³
    /**
     * å¤„ç†ç™»å½•
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        try {
            const response = await fetch(`${API_BASE}/user/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const result = await parseResponse(response);
            if (response.ok && result.code === 1 && result.data) {
                // å­˜å‚¨tokenå’Œç”¨æˆ·ä¿¡æ¯
                token = result.data;
                localStorage.setItem('token', token);
                // è§£ætokenè·å–ç”¨æˆ·IDï¼ˆJWTæ ¼å¼ï¼šheader.payload.signatureï¼‰
                const payload = JSON.parse(atob(token.split('.')[1]));
                currentUser.id = payload.id;
                currentUser.username = username;
                // æš‚æ—¶é»˜è®¤è§’è‰²ä¸ºUSERï¼Œå¦‚éœ€ç²¾å‡†è§’è‰²éœ€è°ƒç”¨æ¥å£æŸ¥è¯¢
                currentUser.role = 'USER';
                localStorage.setItem('userId', currentUser.id);
                localStorage.setItem('username', currentUser.username);

                showMsg('ç™»å½•æˆåŠŸï¼');
                updateLoginStatus();
                // è‡ªåŠ¨å¡«å……å‘å¸ƒè€…ID
                document.getElementById('newPublisherId').value = currentUser.id;
                document.getElementById('updatePublisherId').value = currentUser.id;
                // åˆ‡æ¢åˆ°å•†å“ç®¡ç†é¡µ
                document.querySelector('.tab-btn[data-tab="product"]').click();
                // é‡ç½®è¡¨å•
                document.getElementById('loginForm').reset();
            } else {
                showMsg(result.msg || 'ç™»å½•å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('ç™»å½•é”™è¯¯ï¼š', err);
            showMsg('ç™»å½•å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * å¤„ç†æ³¨å†Œ
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function handleRegister(e) {
        e.preventDefault();
        const username = document.getElementById('regUsername').value.trim();
        const password = document.getElementById('regPassword').value.trim();
        const phone = document.getElementById('regPhone').value.trim();

        try {
            const response = await fetch(`${API_BASE}/user/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password, phone })
            });

            const result = await parseResponse(response);
            if (response.ok && result.code === 1) {
                showMsg('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•ï¼');
                document.getElementById('registerForm').reset();
                // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•
                document.querySelector('.tab-btn[data-tab="auth"]').click();
            } else {
                showMsg(result.msg || 'æ³¨å†Œå¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('æ³¨å†Œé”™è¯¯ï¼š', err);
            showMsg('æ³¨å†Œå¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * å¤„ç†é€€å‡ºç™»å½•
     */
    function handleLogout() {
        // æ¸…é™¤æœ¬åœ°å­˜å‚¨
        localStorage.removeItem('token');
        localStorage.removeItem('userId');
        localStorage.removeItem('username');
        localStorage.removeItem('role');
        // é‡ç½®å…¨å±€å˜é‡
        token = '';
        currentUser = { id: '', username: '', role: 'USER' };
        // æ›´æ–°çŠ¶æ€
        showMsg('å·²é€€å‡ºç™»å½•');
        updateLoginStatus();
        // åˆ‡æ¢åˆ°ç™»å½•é¡µ
        document.querySelector('.tab-btn[data-tab="auth"]').click();
    }

    // 5. ç”¨æˆ·ç®¡ç†ç›¸å…³
    /**
     * è®¾ä¸ºç®¡ç†å‘˜
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function handleToAdmin(e) {
        e.preventDefault();
        const userId = document.getElementById('adminUserId').value.trim();

        try {
            const response = await fetch(`${API_BASE}/user/toadmin?id=${userId}`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const result = await parseResponse(response);
            if (response.ok && result.code === 1) {
                showMsg('è®¾ç½®ç®¡ç†å‘˜æˆåŠŸï¼');
                document.getElementById('toAdminForm').reset();
                // åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
                queryAllUsers();
            } else {
                showMsg(result.msg || 'è®¾ç½®å¤±è´¥ï¼ˆå¯èƒ½æ— ç®¡ç†å‘˜æƒé™ï¼‰', 'error');
            }
        } catch (err) {
            console.error('è®¾ç½®ç®¡ç†å‘˜é”™è¯¯ï¼š', err);
            showMsg('è®¾ç½®å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
     */
    async function queryAllUsers() {
        try {
            const response = await fetch(`${API_BASE}/user/select/all`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const userList = await parseResponse(response);
            const tableBody = document.getElementById('userTableBody');

            if (response.ok && Array.isArray(userList)) {
                if (userList.length > 0) {
                    tableBody.innerHTML = userList.map(user => `
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3 border-b">${user.id}</td>
                                <td class="px-4 py-3 border-b">${user.username}</td>
                                <td class="px-4 py-3 border-b">${user.phone || 'æ— '}</td>
                                <td class="px-4 py-3 border-b">${user.role || 'USER'}</td>
                            </tr>
                        `).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-gray-500">æ— ç”¨æˆ·æ•°æ®</td></tr>';
                }
            } else {
                tableBody.innerHTML = '<tr><td colspan="4" class="px-4 py-8 text-center text-red-500">æŸ¥è¯¢å¤±è´¥</td></tr>';
                showMsg('æŸ¥è¯¢ç”¨æˆ·å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('æŸ¥è¯¢ç”¨æˆ·é”™è¯¯ï¼š', err);
            showMsg('æŸ¥è¯¢ç”¨æˆ·å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * å¤„ç†åˆ é™¤ç”¨æˆ·
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function handleDeleteUser(e) {
        e.preventDefault();
        const userId = document.getElementById('deleteUserId').value.trim();

        try {
            const response = await fetch(`${API_BASE}/user/delete?id=${userId}`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const result = await parseResponse(response);
            if (response.ok && result.code === 1) {
                showMsg('ç”¨æˆ·åˆ é™¤æˆåŠŸï¼');
                document.getElementById('deleteUserForm').reset();
                // åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
                queryAllUsers();
            } else {
                showMsg(result.msg || 'åˆ é™¤å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('åˆ é™¤ç”¨æˆ·é”™è¯¯ï¼š', err);
            showMsg('åˆ é™¤å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    // 6. å•†å“ç®¡ç†ç›¸å…³
    /**
     * æŸ¥è¯¢24å°æ—¶å†…å•†å“
     */
    async function query24hProducts() {
        try {
            const response = await fetch(`${API_BASE}/product/select/24h`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const productList = await parseResponse(response);
            const listContainer = document.getElementById('24hProductsList');

            if (response.ok && Array.isArray(productList)) {
                if (productList.length > 0) {
                    listContainer.innerHTML = productList.map(p => `
                            <div class="p-2 border-b hover:bg-gray-50">
                                <div class="font-medium">${p.title}</div>
                                <div class="text-sm text-gray-600">ä»·æ ¼ï¼šï¿¥${p.price} | çŠ¶æ€ï¼š${p.status}</div>
                            </div>
                        `).join('');
                } else {
                    listContainer.innerHTML = '<div class="text-center text-gray-500 py-4">24å°æ—¶å†…æ— æ–°å¢å•†å“</div>';
                }
            } else {
                listContainer.innerHTML = '<div class="text-center text-red-500 py-4">æŸ¥è¯¢å¤±è´¥</div>';
                showMsg('æŸ¥è¯¢24å°æ—¶å•†å“å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('æŸ¥è¯¢24å°æ—¶å•†å“é”™è¯¯ï¼š', err);
            showMsg('æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * æŒ‰ä»·æ ¼åŒºé—´æŸ¥è¯¢å•†å“
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function queryProductsByPrice(e) {
        e.preventDefault();
        const price1 = document.getElementById('minPrice').value.trim();
        const price2 = document.getElementById('maxPrice').value.trim();

        if (Number(price1) > Number(price2)) {
            showMsg('æœ€ä½ä»·æ ¼ä¸èƒ½å¤§äºæœ€é«˜ä»·æ ¼', 'warning');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/product/select/price?price1=${price1}&price2=${price2}`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const productList = await parseResponse(response);
            const listContainer = document.getElementById('priceProductsList');

            if (response.ok && Array.isArray(productList)) {
                if (productList.length > 0) {
                    listContainer.innerHTML = productList.map(p => `
                            <div class="p-2 border-b hover:bg-gray-50">
                                <div class="font-medium">${p.title}</div>
                                <div class="text-sm text-gray-600">ä»·æ ¼ï¼šï¿¥${p.price}</div>
                            </div>
                        `).join('');
                } else {
                    listContainer.innerHTML = '<div class="text-center text-gray-500 py-2">è¯¥ä»·æ ¼åŒºé—´æ— å•†å“</div>';
                }
            } else {
                listContainer.innerHTML = '<div class="text-center text-red-500 py-2">æŸ¥è¯¢å¤±è´¥</div>';
                showMsg('ä»·æ ¼åŒºé—´æŸ¥è¯¢å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('ä»·æ ¼åŒºé—´æŸ¥è¯¢é”™è¯¯ï¼š', err);
            showMsg('æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰å•†å“æ ‡é¢˜
     */
    async function queryAllProductTitles() {
        try {
            const response = await fetch(`${API_BASE}/product/select/title`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const titleList = await parseResponse(response);
            const listContainer = document.getElementById('allTitlesList');

            if (response.ok && Array.isArray(titleList)) {
                if (titleList.length > 0) {
                    listContainer.innerHTML = titleList.map(title => `
                            <div class="p-2 border-b hover:bg-gray-50 cursor-pointer" onclick="document.getElementById('productTitle').value='${title}'">
                                ${title}
                            </div>
                        `).join('');
                } else {
                    listContainer.innerHTML = '<div class="text-center text-gray-500 py-4">æ— å•†å“æ ‡é¢˜</div>';
                }
            } else {
                listContainer.innerHTML = '<div class="text-center text-red-500 py-4">æŸ¥è¯¢å¤±è´¥</div>';
                showMsg('æŸ¥è¯¢å•†å“æ ‡é¢˜å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('æŸ¥è¯¢å•†å“æ ‡é¢˜é”™è¯¯ï¼š', err);
            showMsg('æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * æŸ¥è¯¢å•†å“è¯¦æƒ…
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function queryProductDetail(e) {
        e.preventDefault();
        const title = document.getElementById('productTitle').value.trim();
        const detailContainer = document.getElementById('productDetailContainer');
        const detailContent = document.getElementById('productDetailContent');

        try {
            const response = await fetch(`${API_BASE}/product/select?title=${encodeURIComponent(title)}`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const productList = await parseResponse(response);
            if (response.ok && Array.isArray(productList)) {
                detailContainer.classList.remove('hidden');
                if (productList.length > 0) {
                    // æ ¼å¼åŒ–JSONæ˜¾ç¤º
                    detailContent.textContent = JSON.stringify(productList[0], null, 2);
                } else {
                    detailContent.textContent = 'æœªæŸ¥è¯¢åˆ°è¯¥å•†å“çš„è¯¦æƒ…';
                }
            } else {
                detailContainer.classList.remove('hidden');
                detailContent.textContent = 'æŸ¥è¯¢å¤±è´¥ï¼š' + (productList.msg || 'æœªçŸ¥é”™è¯¯');
                showMsg('æŸ¥è¯¢å•†å“è¯¦æƒ…å¤±è´¥', 'error');
            }
        } catch (err) {
            console.error('æŸ¥è¯¢å•†å“è¯¦æƒ…é”™è¯¯ï¼š', err);
            detailContainer.classList.remove('hidden');
            detailContent.textContent = 'æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸';
            showMsg('æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    /**
     * å¤„ç†æ–°å¢å•†å“
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function handleAddProduct(e) {
        e.preventDefault();
        const product = {
            title: document.getElementById('newProductTitle').value.trim(),
            type: document.getElementById('newProductType').value.trim(),
            price: parseFloat(document.getElementById('newProductPrice').value.trim()),
            publisher_id: parseInt(document.getElementById('newPublisherId').value.trim()),
            description: document.getElementById('newProductDesc').value.trim(),
            status: document.getElementById('newProductStatus').value.trim()
        };

        // éªŒè¯å‚æ•°
        if (!product.title || !product.type || isNaN(product.price) || !product.publisher_id) {
            showMsg('æ ‡é¢˜ã€ç±»å‹ã€ä»·æ ¼ã€å‘å¸ƒè€…IDä¸èƒ½ä¸ºç©ºï¼Œä»·æ ¼å¿…é¡»æ˜¯æ•°å­—ï¼', 'warning');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/product/create`, {
                method: 'POST',
                headers: getRequestHeaders(),
                body: JSON.stringify(product)
            });

            const result = await parseResponse(response);
            if (response.ok && result.code === 1) {
                showMsg('å•†å“æ–°å¢æˆåŠŸï¼');
                document.getElementById('addProductForm').reset();
                // é‡æ–°å¡«å……å‘å¸ƒè€…ID
                document.getElementById('newPublisherId').value = currentUser.id;
                // åˆ·æ–°å•†å“æ ‡é¢˜åˆ—è¡¨
                queryAllProductTitles();
            } else {
                showMsg(result.msg || 'æ–°å¢å¤±è´¥ï¼ˆå¯èƒ½æ— æƒé™ï¼‰', 'error');
            }
        } catch (err) {
            console.error('æ–°å¢å•†å“é”™è¯¯ï¼š', err);
            showMsg('æ–°å¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    // æœ€ç»ˆä¿®å¤ç‰ˆï¼šæ›´æ–°å•†å“å‡½æ•°ï¼ˆç›´æ¥æ›¿æ¢åŸhandleUpdateProductï¼‰
    // æœ€ç»ˆåŠ¨æ€è·å–ç‰ˆï¼šå’ŒPostman 100%ä¸€è‡´ï¼ŒåŠ¨æ€æ”¶é›†å‚æ•°
    async function handleUpdateProduct(e) {
        e.preventDefault();
        // 1. ä»localStorageè·å–tokenï¼ˆå…³é”®ï¼ï¼‰
        const token = localStorage.getItem('token');
        if (!token) {
            showMsg('è¯·å…ˆç™»å½•ï¼', 'error');
            return;
        }

        // 2. åŠ¨æ€æ”¶é›†å‚æ•°
        const product = {
            id: parseInt(document.getElementById('updateProductId').value.trim()),
            title: document.getElementById('updateProductTitle').value.trim(),
            description: document.getElementById('updateProductDesc').value.trim(),
            type: document.getElementById('updateProductType').value.trim(),
            price: parseFloat(document.getElementById('updateProductPrice').value.trim()),
            status: document.getElementById('updateProductStatus').value.trim()
        };

        // 3. å‚æ•°æ ¡éªŒ
        const errors = [];
        if (isNaN(product.id) || product.id <= 0) errors.push('å•†å“IDå¿…é¡»æ˜¯æœ‰æ•ˆæ­£æ•°');
        if (!product.title.trim()) errors.push('æ ‡é¢˜ä¸èƒ½ä¸ºç©º');
        if (!product.description.trim()) errors.push('æè¿°ä¸èƒ½ä¸ºç©º');
        if (!['äºŒæ‰‹ç‰©å“', 'ä»£å–éœ€æ±‚'].includes(product.type)) errors.push('ç±»å‹åªèƒ½æ˜¯"äºŒæ‰‹ç‰©å“"æˆ–"ä»£å–éœ€æ±‚"');
        if (isNaN(product.price) || product.price < 0 || product.price > 999999) errors.push('ä»·æ ¼å¿…é¡»æ˜¯0-999999çš„æ•°å­—');
        if (!['æœªå”®å‡º', 'å·²å”®å‡º'].includes(product.status)) errors.push('çŠ¶æ€åªèƒ½æ˜¯"æœªå”®å‡º"æˆ–"å·²å”®å‡º"');
        if (errors.length > 0) {
            showMsg(`å‚æ•°é”™è¯¯ï¼š${errors.join('ã€')}`, 'error');
            return;
        }

        try {
            const requestBody = JSON.stringify(product);
            console.log('è¯·æ±‚tokenï¼š', token); // ç¡®è®¤tokenä¸ä¸ºç©ºä¸”æ­£ç¡®
            console.log('è¯·æ±‚ä½“ï¼š', requestBody);

            const response = await fetch(`${API_BASE}/product/update`, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'token': token, // ç”¨localStorageçš„token
                    'Content-Type': 'application/json',
                    'Accept': '*/*'
                },
                body: requestBody
            });

            const rawResponse = await response.text();
            console.log('å“åº”çŠ¶æ€ï¼š', response.status);
            console.log('å“åº”ä½“ï¼š', rawResponse);

            let result = JSON.parse(rawResponse);
            if (response.status === 200 && result.code === 1) {
                showMsg('æ›´æ–°æˆåŠŸï¼', 'success');
                document.getElementById('updateProductForm').reset();
            } else if (response.status === 401) {
                showMsg('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼', 'error');
                localStorage.removeItem('token'); // æ¸…é™¤æ— æ•ˆtoken
            } else if (response.status === 403) {
                showMsg('æ— æƒé™ï¼ˆä»…å‘å¸ƒè€…å¯æ›´æ–°ï¼‰', 'error');
            } else {
                showMsg(`æ›´æ–°å¤±è´¥ï¼š${result.msg}`, 'error');
            }
        } catch (err) {
            console.error('é”™è¯¯ï¼š', err);
            showMsg('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·é‡è¯•', 'error');
        }
    }
    /**
     * å¤„ç†åˆ é™¤å•†å“
     * @param {Event} e - äº‹ä»¶å¯¹è±¡
     */
    async function handleDeleteProduct(e) {
        e.preventDefault();
        const productId = document.getElementById('deleteProductId').value.trim();

        if (!productId || productId <= 0) {
            showMsg('è¯·è¾“å…¥åˆæ³•çš„å•†å“IDï¼', 'warning');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/product/delete?id=${productId}`, {
                method: 'GET',
                headers: getRequestHeaders()
            });

            const result = await parseResponse(response);
            if (response.ok && result.code === 1) {
                showMsg('å•†å“åˆ é™¤æˆåŠŸï¼');
                document.getElementById('deleteProductForm').reset();
                // åˆ·æ–°å•†å“æ ‡é¢˜åˆ—è¡¨
                queryAllProductTitles();
            } else {
                showMsg(result.msg || 'åˆ é™¤å¤±è´¥ï¼ˆå¯èƒ½æ— æƒé™æˆ–å•†å“ä¸å­˜åœ¨ï¼‰', 'error');
            }
        } catch (err) {
            console.error('åˆ é™¤å•†å“é”™è¯¯ï¼š', err);
            showMsg('åˆ é™¤å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸', 'error');
        }
    }

    // 7. è®¢å•ç®¡ç†ç›¸å…³
    // æ›¿æ¢åŸæœ‰çš„ è®¢å•ç›¸å…³3ä¸ªå‡½æ•°ï¼Œå…¶ä»–ä»£ç ä¸å˜ï¼
    // 1. ä¿®å¤ï¼šä¸‹å•åŠŸèƒ½ï¼ˆhandleCreateOrderï¼‰
    async function handleCreateOrder(e) {
        e.preventDefault();
        if (!token) {
            showMsg('è¯·å…ˆç™»å½•ï¼', 'error');
            return;
        }

        // 1. ä¸¥æ ¼åŒ¹é…åç«¯å‚æ•°åï¼ˆbuyeridã€productidï¼Œå…¨å°å†™ï¼Œæ— ä¸‹åˆ’çº¿ï¼‰
        const buyerid = document.getElementById('orderBuyerId').value.trim();
        const productid = document.getElementById('orderProductId').value.trim();

        // éªŒè¯å‚æ•°ï¼ˆç¡®ä¿æ˜¯æ•°å­—ï¼ŒåŒ¹é…åç«¯Integerç±»å‹ï¼‰
        if (!buyerid || !productid || isNaN(Number(buyerid)) || isNaN(Number(productid))) {
            showMsg('ä¹°å®¶IDå’Œå•†å“IDå¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—ï¼', 'warning');
            return;
        }

        try {
            // 2. ä¸¥æ ¼åŒ¹é…åç«¯æ¥å£è·¯å¾„ï¼ˆ/placeorderï¼Œæ— å¤šä½™è·¯å¾„ï¼‰
            const requestUrl = `${API_BASE}/placeorder?buyerid=${buyerid}&productid=${productid}`;
            console.log('ä¸‹å•è¯·æ±‚URLï¼š', requestUrl); // è°ƒè¯•æ—¥å¿—ï¼šæ‰“å°URL
            console.log('ä¼ é€’çš„tokenï¼š', token); // è°ƒè¯•æ—¥å¿—ï¼šç¡®è®¤tokenå­˜åœ¨

            const response = await fetch(requestUrl, {
                method: 'GET', // åç«¯æ˜¯GETï¼Œä¸¥æ ¼åŒ¹é…
                headers: {
                    'token': token, // å¿…ä¼ tokenï¼ŒåŒ¹é…åç«¯æ‹¦æˆªå™¨
                    'Content-Type': 'application/json'
                }
            });

            // 3. è°ƒè¯•æ—¥å¿—ï¼šæ‰“å°å“åº”çŠ¶æ€ç ï¼ˆ401=tokenæ— æ•ˆï¼Œ403=æƒé™ä¸è¶³ï¼Œ404=è·¯å¾„é”™ï¼Œ500=åç«¯æŠ¥é”™ï¼‰
            console.log('ä¸‹å•å“åº”çŠ¶æ€ç ï¼š', response.status);
            const rawResponse = await response.text(); // åç«¯è¿”å›Stringç±»å‹çš„Result JSON
            console.log('ä¸‹å•åç«¯åŸå§‹å“åº”ï¼š', rawResponse); // è°ƒè¯•æ—¥å¿—ï¼šæŸ¥çœ‹åç«¯è¿”å›çš„å…·ä½“å†…å®¹

            // 4. è§£æåç«¯å“åº”ï¼ˆå…¼å®¹Stringæ ¼å¼çš„Result JSONï¼‰
            let result;
            try {
                result = JSON.parse(rawResponse); // åç«¯è¿”å›çš„æ˜¯"{\"code\":1,\"msg\":\"...\"}"
            } catch (parseErr) {
                result = { code: 0, msg: rawResponse }; // è§£æå¤±è´¥ç›´æ¥å–åŸå§‹æ–‡æœ¬
            }

            // 5. ç²¾å‡†é”™è¯¯æç¤ºï¼ˆåŒ¹é…åç«¯å“åº”çŠ¶æ€ï¼‰
            if (response.status === 401) {
                showMsg('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼', 'error');
                handleLogout(); // è‡ªåŠ¨é€€å‡ºç™»å½•
            } else if (response.status === 403) {
                showMsg(`ä¸‹å•å¤±è´¥ï¼š${result.msg || 'æ— æƒé™ï¼ˆä¸èƒ½è´­ä¹°è‡ªå·±å‘å¸ƒçš„å•†å“ï¼‰'}`, 'error');
            } else if (response.status === 404) {
                showMsg('ä¸‹å•å¤±è´¥ï¼šæ¥å£è·¯å¾„é”™è¯¯ï¼ˆåç«¯æ— æ­¤æ¥å£ï¼‰', 'error');
            } else if (response.status === 200 && result.code === 1) {
                showMsg('ä¸‹å•æˆåŠŸï¼');
                document.getElementById('createOrderForm').reset();
                queryAllOrders(); // åˆ·æ–°è®¢å•åˆ—è¡¨
            } else {
                showMsg(`ä¸‹å•å¤±è´¥ï¼š${result.msg || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (err) {
            console.error('ä¸‹å•åŠŸèƒ½å¼‚å¸¸ï¼š', err);
            showMsg('ä¸‹å•å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸æˆ–åç«¯æœªå¯åŠ¨', 'error');
        }
    }

    // 2. ä¿®å¤ï¼šå–æ¶ˆè®¢å•åŠŸèƒ½ï¼ˆhandleCancelOrderï¼‰
    async function handleCancelOrder(e) {
        e.preventDefault();
        if (!token) {
            showMsg('è¯·å…ˆç™»å½•ï¼', 'error');
            return;
        }

        const buyerid = document.getElementById('cancelBuyerId').value.trim();
        const productid = document.getElementById('cancelProductId').value.trim();

        // éªŒè¯å‚æ•°ï¼ˆç¡®ä¿æ˜¯æ•°å­—ï¼‰
        if (!buyerid || !productid || isNaN(Number(buyerid)) || isNaN(Number(productid))) {
            showMsg('ä¹°å®¶IDå’Œå•†å“IDå¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—ï¼', 'warning');
            return;
        }

        try {
            // ä¸¥æ ¼åŒ¹é…åç«¯æ¥å£è·¯å¾„å’Œå‚æ•°å
            const requestUrl = `${API_BASE}/cancelorder?buyerid=${buyerid}&productid=${productid}`;
            console.log('å–æ¶ˆè®¢å•è¯·æ±‚URLï¼š', requestUrl);
            console.log('ä¼ é€’çš„tokenï¼š', token);

            const response = await fetch(requestUrl, {
                method: 'GET',
                headers: {
                    'token': token,
                    'Content-Type': 'application/json'
                }
            });

            console.log('å–æ¶ˆè®¢å•å“åº”çŠ¶æ€ç ï¼š', response.status);
            const rawResponse = await response.text();
            console.log('å–æ¶ˆè®¢å•åç«¯åŸå§‹å“åº”ï¼š', rawResponse);

            let result;
            try {
                result = JSON.parse(rawResponse);
            } catch (parseErr) {
                result = { code: 0, msg: rawResponse };
            }

            // ç²¾å‡†é”™è¯¯æç¤º
            if (response.status === 401) {
                showMsg('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼', 'error');
                handleLogout();
            } else if (response.status === 403) {
                showMsg(`å–æ¶ˆå¤±è´¥ï¼š${result.msg || 'æ— æƒé™ï¼ˆä»…ä¹°å®¶/å–å®¶å¯å–æ¶ˆï¼‰'}`, 'error');
            } else if (response.status === 404) {
                showMsg('å–æ¶ˆå¤±è´¥ï¼šæ¥å£è·¯å¾„é”™è¯¯', 'error');
            } else if (response.status === 200 && result.code === 1) {
                showMsg('å–æ¶ˆè®¢å•æˆåŠŸï¼');
                document.getElementById('cancelOrderForm').reset();
                queryAllOrders();
            } else {
                showMsg(`å–æ¶ˆå¤±è´¥ï¼š${result.msg || 'è®¢å•ä¸å­˜åœ¨æˆ–å·²å–æ¶ˆ'}`, 'error');
            }
        } catch (err) {
            console.error('å–æ¶ˆè®¢å•åŠŸèƒ½å¼‚å¸¸ï¼š', err);
            showMsg('å–æ¶ˆå¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸æˆ–åç«¯æœªå¯åŠ¨', 'error');
        }
    }

    // 3. ä¿®å¤ï¼šæŸ¥è¯¢è®¢å•åŠŸèƒ½ï¼ˆqueryAllOrdersï¼‰
    async function queryAllOrders() {
        if (!token) {
            showMsg('è¯·å…ˆç™»å½•ï¼', 'error');
            return;
        }

        try {
            // ä¸¥æ ¼åŒ¹é…åç«¯æŸ¥è¯¢æ¥å£è·¯å¾„
            const requestUrl = `${API_BASE}/productorder/select/all`;
            console.log('æŸ¥è¯¢è®¢å•è¯·æ±‚URLï¼š', requestUrl);
            console.log('ä¼ é€’çš„tokenï¼š', token);

            const response = await fetch(requestUrl, {
                method: 'GET',
                headers: {
                    'token': token,
                    'Content-Type': 'application/json'
                }
            });

            console.log('æŸ¥è¯¢è®¢å•å“åº”çŠ¶æ€ç ï¼š', response.status);
            const rawResponse = await response.text();
            console.log('æŸ¥è¯¢è®¢å•åç«¯åŸå§‹å“åº”ï¼š', rawResponse);

            // å¤„ç†å“åº”ï¼ˆåç«¯æˆåŠŸè¿”å›List<ProductOrder>ï¼Œå¤±è´¥è¿”å›401/403çš„Resultå­—ç¬¦ä¸²ï¼‰
            if (response.status === 401) {
                showMsg('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼', 'error');
                handleLogout();
                document.getElementById('orderTableBody').innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">ç™»å½•å·²è¿‡æœŸ</td></tr>';
                return;
            } else if (response.status === 403) {
                showMsg('æ— æƒé™æŸ¥è¯¢è®¢å•ï¼', 'error');
                document.getElementById('orderTableBody').innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">æ— æƒé™æŸ¥è¯¢</td></tr>';
                return;
            } else if (response.status === 404) {
                showMsg('æŸ¥è¯¢å¤±è´¥ï¼šæ¥å£è·¯å¾„é”™è¯¯', 'error');
                document.getElementById('orderTableBody').innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">æ¥å£ä¸å­˜åœ¨</td></tr>';
                return;
            }

            // è§£æè®¢å•åˆ—è¡¨ï¼ˆåç«¯æˆåŠŸè¿”å›JSONæ•°ç»„ï¼‰
            let orderList;
            try {
                orderList = JSON.parse(rawResponse);
            } catch (parseErr) {
                orderList = [];
                showMsg('æŸ¥è¯¢å¤±è´¥ï¼šåç«¯è¿”å›æ•°æ®æ ¼å¼é”™è¯¯', 'error');
            }

            const tableBody = document.getElementById('orderTableBody');
            if (Array.isArray(orderList) && orderList.length > 0) {
                // ä¸¥æ ¼åŒ¹é…ProductOrderå­—æ®µï¼ˆidã€buyer_idã€product_idã€statusã€create_timeï¼‰
                tableBody.innerHTML = orderList.map(order => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 border-b">${order.id || 'æœªçŸ¥'}</td>
                    <td class="px-4 py-3 border-b">${order.buyer_id || 'æœªçŸ¥'}</td>
                    <td class="px-4 py-3 border-b">${order.product_id || 'æœªçŸ¥'}</td>
                    <td class="px-4 py-3 border-b">${order.status || 'å·²ä¸‹å•'}</td>
                    <td class="px-4 py-3 border-b">${order.create_time ? order.create_time.split('T')[0] + ' ' + order.create_time.split('T')[1].substring(0, 8) : 'æœªçŸ¥'}</td>
                </tr>
            `).join('');
            } else {
                tableBody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">æ— è®¢å•æ•°æ®ï¼ˆæœªä¸‹å•æˆ–æŸ¥è¯¢å¤±è´¥ï¼‰</td></tr>';
            }
        } catch (err) {
            console.error('æŸ¥è¯¢è®¢å•åŠŸèƒ½å¼‚å¸¸ï¼š', err);
            showMsg('æŸ¥è¯¢å¤±è´¥ï¼šç½‘ç»œå¼‚å¸¸æˆ–åç«¯æœªå¯åŠ¨', 'error');
            document.getElementById('orderTableBody').innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">ç½‘ç»œå¼‚å¸¸</td></tr>';
        }
    }
</script>
</body>
</html>